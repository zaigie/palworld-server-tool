# 自助编译及更新指南

## 更新失效问题说明

1.~~pst对于存档解析的关键工具是palworld-save-tools，负责解析sav存档文件，更新后存档不能解析就是由于这个项目没有适配新存档，进而影响了基于这个项目生成的sav_cli文件。所以只要更新了新版本的palworld-save-tools，存档解析功能就能正常使用。~~
另外，sav_cli无法解析只影响pst右侧的帕鲁/物品展示，不影响其他功能。

2.记录物品和帕鲁名称的文件在web/src/assets文件夹中，分别为items.json和pal.json，对应的图片文件夹是items和pals。新帕鲁和新物品显示异常，参考文件内其他例子，更新这两个文件即可。

注意：

1.执行编译的系统版本尽量选择与运行pst的系统一致的版本，不然编译出来的程序复制过去运行可能会报错。

2.反复编译时先删除asset文件夹

下面是具体编译和更新的方法，使用系统版本：ubuntu22.04、windows10

需要准备的环境：go、nodejs、python3

可供参考的版本：go1.21.4、nodejs18、python3.11

## linux编译方法

### 1.下载源码文件

直接用git从github上拉取最新代码

```
git clone https://github.com/zaigie/palworld-server-tool.git
```

### 2.编译sav_cli

~~进入module文件夹，将requirements.txt文件中的palworld-save-tools==0.23.0改到最新版本（如0.23.1），最新版本可以在[pal-save-tools](https://github.com/cheahjs/palworld-save-tools)找到。之后执行如下命令：~~

```
cd module
sudo chmod 777 build.sh
./build.sh
```

注意：原来的项目已经长期无人维护，帕鲁存档也使用了oodle加密，需要自行获取sav_cli文件

### 3.编译项目

回到palworld-save-tools文件夹进行编译

```
cd ..
make init
make build-pub
```

编译好的文件在dist目录下

## windows编译方法

### 1.下载源码文件

直接用git从github上拉取最新代码

```
git clone https://github.com/zaigie/palworld-server-tool.git
```

### 2.拉取地图文件

```
python3 map_down.py
```

### 3.编译前端文件

```
cd web
pnpm i
pnpm build
cd ..
```

### 4.拉取pal-conf更新并编译

```
git submodule update --init --recursive
cd pal-conf
pnpm i
pnpm build
cd ..
move pal-conf\dist\assets\* assets\
move pal-conf\dist\index.html pal-conf.html
```

### 5.编译可执行程序

```
go build -o ./dist/pst.exe main.go
```

编译好的文件在dist目录下

## 可能遇到的错误和解决方法

### 报错make: go: 没有那个文件或目录

解决办法： 安装go环境 参考这里https://golang.google.cn/doc/install 如果 go mod download下不动，运行这一句 `go env -w GOPROXY=https://goproxy.io,direct`

### 报错/bin/sh: 1: pnpm: not found

解决办法： 运行下面代码 `curl -fsSL https://get.pnpm.io/install.sh | sh - source /home/ubuntu/.bashrc`

### 报错pnpm: not found: node

解决办法： 安装nodejs18（可能是14以上就行，18比较稳妥）`curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash source /home/ubuntu/.bashrc nvm install 18.20.4 nvm alias default 18.20.4`

### 报错FATAL ERROR: Ineffective mark-compacts near heap limit Allocation failed - JavaScript heap out of memory

解决办法： 运行以下命令，不一定8192，反正搞大点 `export NODE_OPTIONS="--max-old-space-size=8192"`

### 报错./build.sh: 行 3: pyinstaller: 未找到命令

解决办法： `sudo apt install python3-pip pip3 install --upgrade pip pip3 install pyinstaller` 然后命令行输入`pip3 show pyinstaller` 记下这一行Location: /home/ubuntu/.local/lib/python3.10/site-packages 然后在.profile文件最后加上这一行PATH=$PATH:/home/ubuntu/.local/lib/python3.10/site-packages 最后运行这一句 `source /home/ubuntu/.profile`